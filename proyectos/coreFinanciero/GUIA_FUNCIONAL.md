# Gu√≠a Funcional - Core Financiero

## üè¶ ¬øQu√© es Core Financiero?

**Core Financiero** es el coraz√≥n digital de las operaciones de tesorer√≠a de una instituci√≥n financiera. Imag√≠nelo como el cerebro que controla todos los movimientos de dinero, desde un simple dep√≥sito hasta complejas operaciones de inversi√≥n.

En t√©rminos simples, es un sistema que **registra, valida, procesa y controla** cada peso que entra y sale de la instituci√≥n, asegurando que todo est√© debidamente documentado, autorizado y cumpliendo con las regulaciones financieras.

### **Migraci√≥n Exitosa de PL/SQL a Java**
Este sistema representa una **modernizaci√≥n tecnol√≥gica completa**, migrando desde procedimientos almacenados en PL/SQL hacia una arquitectura moderna basada en **Spring Boot**, manteniendo toda la l√≥gica de negocio cr√≠tica mientras se mejora la mantenibilidad, escalabilidad y capacidad de integraci√≥n.

---

## üí° ¬øPor Qu√© es Fundamental para las Instituciones Financieras?

### **El Problema que Resuelve**

Imagine una instituci√≥n financiera sin un sistema como Core Financiero:

- **Caos en los registros**: Los movimientos de dinero se registrar√≠an manualmente o en sistemas separados
- **Errores humanos**: Sin validaciones autom√°ticas, los errores ser√≠an frecuentes y costosos
- **Falta de control**: No habr√≠a forma de saber en tiempo real cu√°nto dinero hay disponible
- **Riesgo regulatorio**: Incumplimiento de normativas por falta de trazabilidad
- **P√©rdidas financieras**: Operaciones duplicadas, saldos incorrectos, fraudes no detectados

### **La Soluci√≥n que Proporciona**

Core Financiero act√∫a como un **sistema nervioso central** que:

1. **Captura** cada operaci√≥n financiera
2. **Valida** que cumple con las reglas de negocio
3. **Procesa** la operaci√≥n de forma segura
4. **Actualiza** autom√°ticamente los saldos
5. **Registra** todo para auditor√≠a y cumplimiento

---

## üéØ Funciones Principales y su Importancia

### 1. **Gesti√≥n de Pre-Movimientos** üìù

#### ¬øQu√© es?
Un "pre-movimiento" es como un **borrador** de una operaci√≥n financiera. Es la intenci√≥n de realizar una transacci√≥n que a√∫n no ha sido ejecutada definitivamente.

#### ¬øPor qu√© es importante?
- **Control previo**: Permite revisar y validar operaciones antes de que afecten los saldos reales
- **Prevenci√≥n de errores**: Los errores se pueden corregir antes de causar impacto financiero
- **Flujo de aprobaci√≥n**: Las operaciones grandes pueden requerir m√∫ltiples aprobaciones
- **Planificaci√≥n**: Permite programar operaciones para fechas futuras

#### Ejemplo Pr√°ctico
Un cliente solicita un pr√©stamo de $100,000:
1. **Pre-movimiento**: Se registra la intenci√≥n de otorgar el pr√©stamo con `POST /api/v1/movimientos/pre-movimiento`
2. **Validaci√≥n**: El sistema verifica autom√°ticamente fechas de liquidaci√≥n, saldos disponibles y reglas de negocio
3. **Detalles**: Se agregan conceptos como intereses y comisiones con `POST /api/v1/movimientos/pre-movimiento-detalle`
4. **Procesamiento**: Se convierte en movimiento real usando `POST /api/v1/movimientos/procesar-pre-movimientos`
5. **Finalizaci√≥n**: Se confirma con `POST /api/v1/movimientos/procesar-virtuales-a-reales`

#### Funcionalidades Avanzadas de Pre-Movimientos
- **Consulta de pendientes**: `GET /api/v1/movimientos/pendientes` permite ver todos los pre-movimientos por fecha de liquidaci√≥n
- **C√°lculo autom√°tico**: `GET /api/v1/movimientos/total-conceptos/{id}` suma autom√°ticamente todos los conceptos
- **Procesamiento masivo**: `POST /api/v1/movimientos/procesar-pendientes` procesa todos los movimientos pendientes de una empresa

---

### 2. **Procesamiento de Movimientos** ‚ö°

#### Estados del Movimiento

**üîµ No Procesado (NP)**
- La operaci√≥n est√° registrada pero no ha sido validada
- **Importancia**: Permite detectar y corregir errores antes del procesamiento

**üü° Procesado Virtual (PV)**
- La operaci√≥n pas√≥ todas las validaciones pero no afecta saldos reales
- **Importancia**: Estado de seguridad que permite revisiones finales

**üü¢ Procesado Real (PR)**
- La operaci√≥n est√° completamente ejecutada y afecta saldos
- **Importancia**: Estado final que confirma la ejecuci√≥n exitosa

**üî¥ Cancelado (CA)**
- La operaci√≥n fue cancelada y cualquier efecto fue revertido
- **Importancia**: Permite deshacer operaciones err√≥neas sin impacto permanente

#### ¬øPor qu√© estos estados son cr√≠ticos?

**Para la Instituci√≥n:**
- **Seguridad**: M√∫ltiples puntos de control antes de afectar dinero real
- **Auditor√≠a**: Trazabilidad completa de cada cambio de estado
- **Cumplimiento**: Satisface requerimientos regulatorios de control interno

**Para los Clientes:**
- **Confianza**: Sus operaciones est√°n protegidas por m√∫ltiples validaciones
- **Transparencia**: Pueden conocer el estado exacto de sus transacciones a trav√©s de APIs REST
- **Correcci√≥n**: Errores pueden ser corregidos sin afectar sus cuentas mediante `POST /{id}/cancelar`

#### Capacidades Operativas del Sistema
- **Consulta de movimientos**: `GET /api/v1/movimientos/{empresa}` con filtros por situaci√≥n y fecha
- **Seguimiento individual**: `GET /api/v1/movimientos/{empresa}/{id}` para movimientos espec√≠ficos
- **Cancelaci√≥n controlada**: Reversi√≥n autom√°tica de saldos al cancelar operaciones
- **Consulta de cat√°logo**: `GET /api/v1/movimientos/catalogo-operaciones` para operaciones disponibles
- **Monitoreo de pendientes**: `GET /api/v1/movimientos/pendientes-procesamiento` para supervisi√≥n operativa

---

### 3. **Gesti√≥n de Fechas y Liquidaci√≥n** üìÖ

#### ¬øQu√© son las Fechas de Liquidaci√≥n?

En el mundo financiero, las operaciones no siempre se **ejecutan** el mismo d√≠a que se **liquidan** (cuando realmente se transfiere el dinero).

#### Tipos de Liquidaci√≥n:

**T+0**: Liquidaci√≥n el mismo d√≠a
- **Uso**: Operaciones urgentes, transferencias interbancarias
- **Importancia**: Para operaciones que requieren disponibilidad inmediata

**T+1, T+2, T+3**: Liquidaci√≥n en 1, 2 o 3 d√≠as h√°biles
- **Uso**: Operaciones est√°ndar, inversiones, pagos programados
- **Importancia**: Permite optimizar flujos de efectivo y cumplir con est√°ndares del mercado

#### ¬øPor qu√© es fundamental?

**Gesti√≥n de Liquidez:**
- Permite saber exactamente cu√°nto dinero estar√° disponible cada d√≠a
- Facilita la planificaci√≥n de inversiones y pr√©stamos
- Evita problemas de liquidez que podr√≠an causar incumplimientos

**Cumplimiento Normativo:**
- Las regulaciones financieras exigen tiempos espec√≠ficos de liquidaci√≥n
- Diferentes tipos de operaci√≥n tienen diferentes requerimientos
- El incumplimiento puede resultar en multas severas

**Eficiencia Operativa:**
- Optimiza el uso del capital disponible
- Reduce costos financieros por manejo inadecuado de liquidez
- Mejora la rentabilidad de la instituci√≥n

#### Funcionalidades Automatizadas de Fechas
- **Creaci√≥n masiva**: `POST /api/v1/liquidacion/crear-fechas-anio` genera todas las fechas h√°biles del a√±o
- **Validaci√≥n inteligente**: `GET /api/v1/liquidacion/validar-fecha` verifica fechas de liquidaci√≥n seg√∫n tipo de operaci√≥n
- **Gesti√≥n del sistema**: `POST /api/v1/fechas/recorrer` avanza autom√°ticamente al siguiente d√≠a h√°bil
- **Consulta de fechas**: `GET /api/v1/fechas/sistema` obtiene la fecha operativa actual
- **Verificaci√≥n de d√≠as h√°biles**: `GET /api/v1/fechas/validar-dia-habil` confirma si una fecha es operativa
- **Actualizaci√≥n manual**: `PUT /api/v1/fechas/sistema` permite ajustes controlados de fecha sistema

---

### 4. **Control de Saldos** üí∞

#### ¬øC√≥mo Funciona?

Cada operaci√≥n financiera puede:
- **Incrementar saldos** (dep√≥sitos, pagos recibidos, intereses ganados)
- **Decrementar saldos** (retiros, pagos realizados, comisiones)
- **No afectar saldos** (consultas, cambios de informaci√≥n)

#### ¬øPor qu√© es Cr√≠tico?

**Precisi√≥n Financiera:**
- Cada centavo debe estar correctamente contabilizado
- Los errores en saldos pueden causar p√©rdidas millonarias
- La confianza del cliente depende de saldos exactos

**Gesti√≥n de Riesgos:**
- Previene sobregiros no autorizados
- Identifica operaciones sospechosas o inusuales
- Mantiene l√≠mites de exposici√≥n por cliente o producto

**Regulatorio:**
- Los reguladores exigen conciliaciones diarias exactas
- Los saldos incorrectos pueden indicar fraude o mala gesti√≥n
- Requerido para reportes de capital y liquidez

#### Capacidades de Consulta de Saldos
- **Saldos por empresa**: `GET /api/v1/movimientos/saldos/{empresa}` obtiene posiciones actuales
- **Saldos hist√≥ricos**: Filtro por `fechaFoto` para consultar saldos en fechas espec√≠ficas
- **Saldos por cuenta**: Filtro por `idCuenta` para consultas detalladas
- **Actualizaci√≥n autom√°tica**: Los saldos se actualizan instant√°neamente con cada movimiento procesado
- **Multidivisa**: Soporte para m√∫ltiples divisas con control independiente por moneda

---

## üöÄ Arquitectura Moderna y APIs REST

### **Transformaci√≥n Tecnol√≥gica**

El sistema ha evolucionado de una arquitectura basada en procedimientos almacenados PL/SQL hacia una **arquitectura moderna de microservicios** con las siguientes caracter√≠sticas:

#### **Stack Tecnol√≥gico Actual**
- **Framework**: Spring Boot 3.5.4 con Java 21
- **APIs**: REST completas con documentaci√≥n OpenAPI/Swagger
- **Base de Datos**: Soporte para H2 (desarrollo) y bases relacionales empresariales
- **Arquitectura**: Clean Architecture con separaci√≥n clara de capas
- **Testing**: Cobertura de pruebas del 75% con JaCoCo
- **Validaciones**: Bean Validation con anotaciones declarativas

#### **Beneficios de la Modernizaci√≥n**
- **Integraci√≥n**: APIs REST facilitan integraci√≥n con sistemas externos
- **Mantenimiento**: C√≥digo Java m√°s legible y mantenible que PL/SQL
- **Escalabilidad**: Arquitectura preparada para crecimiento horizontal
- **Testing**: Pruebas unitarias e integraci√≥n automatizadas
- **Documentaci√≥n**: APIs autodocumentadas con Swagger UI
- **DevOps**: Preparado para pipelines de CI/CD modernos

#### **Endpoints Organizados por Funcionalidad**

**üîÑ Procesamiento de Movimientos**
- `POST /api/v1/movimientos/procesar-pre-movimientos`
- `POST /api/v1/movimientos/procesar-virtuales-a-reales`
- `POST /api/v1/movimientos/{id}/cancelar`

**üìä Consultas y Reportes**
- `GET /api/v1/movimientos/{empresa}` - Movimientos por empresa
- `GET /api/v1/movimientos/saldos/{empresa}` - Consulta de saldos
- `GET /api/v1/movimientos/catalogo-operaciones/{empresa}` - Operaciones disponibles

**üìÖ Gesti√≥n de Fechas**
- `POST /api/v1/fechas/recorrer` - Avance de fecha sistema
- `GET /api/v1/fechas/validar-dia-habil` - Validaci√≥n de d√≠as h√°biles
- `POST /api/v1/liquidacion/crear-fechas-anio` - Generaci√≥n masiva de fechas

---

## üèóÔ∏è Arquitectura del Flujo Operativo

### **Flujo T√≠pico de una Operaci√≥n**

```
1. CLIENTE SOLICITA OPERACI√ìN
   ‚Üì
2. REGISTRO DE PRE-MOVIMIENTO
   üì° POST /api/v1/movimientos/pre-movimiento
   ‚Üì (Validaciones autom√°ticas: fechas, saldos, reglas)
3. AGREGAR CONCEPTOS DETALLADOS
   üì° POST /api/v1/movimientos/pre-movimiento-detalle
   ‚Üì (Intereses, comisiones, etc.)
4. VERIFICACI√ìN DE REGLAS DE NEGOCIO
   üì° GET /api/v1/liquidacion/validar-fecha
   üì° GET /api/v1/fechas/validar-dia-habil
   ‚Üì (¬øFecha v√°lida? ¬øSaldo suficiente? ¬øCliente autorizado?)
5. PROCESAMIENTO VIRTUAL
   üì° POST /api/v1/movimientos/procesar-pre-movimientos
   ‚Üì (Estado PV - Listo para ejecuci√≥n)
6. APROBACI√ìN FINAL Y PROCESAMIENTO REAL
   üì° POST /api/v1/movimientos/procesar-virtuales-a-reales
   ‚Üì (Estado PR - Saldo afectado autom√°ticamente)
7. CONFIRMACI√ìN Y SEGUIMIENTO
   üì° GET /api/v1/movimientos/{empresa}/{id}
   üì° GET /api/v1/movimientos/saldos/{empresa}
```

### **Validaciones Autom√°ticas que Protegen la Instituci√≥n**

**Validaci√≥n de Fechas:**
- ¬øEs d√≠a h√°bil?
- ¬øLa fecha de liquidaci√≥n es v√°lida para este tipo de operaci√≥n?
- ¬øNo es una fecha pasada incorrecta?

**Validaci√≥n de Fondos:**
- ¬øHay saldo suficiente para la operaci√≥n?
- ¬øSe respetan los l√≠mites establecidos?
- ¬øLa operaci√≥n no excede los l√≠mites regulatorios?

**Validaci√≥n de Integridad:**
- ¬øLos datos son consistentes?
- ¬øLa operaci√≥n est√° completa?
- ¬øTodos los campos requeridos est√°n presentes?

---

## üß™ Calidad y Confiabilidad del Sistema

### **Cobertura de Pruebas del 75%**

El sistema mantiene una **cobertura de pruebas del 75%** garantizada por JaCoCo, lo que significa:

#### **Tipos de Pruebas Implementadas**
- **Pruebas Unitarias**: Verifican la l√≥gica individual de cada componente
- **Pruebas de Integraci√≥n**: Validan la interacci√≥n entre servicios y base de datos
- **Pruebas de Controladores**: Confirman el funcionamiento correcto de las APIs REST
- **Pruebas de Repositorio**: Aseguran la correcta persistencia de datos

#### **Beneficios de la Alta Cobertura**
- **Confianza**: Cada cambio est√° respaldado por pruebas automatizadas
- **Calidad**: Detecci√≥n temprana de errores antes de producci√≥n
- **Mantenimiento**: Facilita refactorizaciones seguras del c√≥digo
- **Documentaci√≥n viva**: Las pruebas sirven como documentaci√≥n del comportamiento esperado

#### **Validaciones Autom√°ticas en C√≥digo**
- **Bean Validation**: Validaciones declarativas en DTOs y entidades
- **Transacciones**: Manejo autom√°tico de rollback en caso de errores
- **Logging**: Trazabilidad completa de operaciones para auditor√≠a
- **Manejo de errores**: Respuestas HTTP estructuradas para diferentes tipos de error

### **Migraci√≥n Exitosa desde PL/SQL**

La migraci√≥n ha preservado **100% de la funcionalidad cr√≠tica** mientras mejora:
- **Mantenibilidad**: C√≥digo Java m√°s legible que procedimientos PL/SQL
- **Testing**: Imposible hacer pruebas unitarias efectivas en PL/SQL
- **Integraci√≥n**: APIs REST vs. llamadas directas a base de datos
- **Escalabilidad**: Arquitectura de capas vs. l√≥gica en base de datos
- **DevOps**: Despliegues automatizados vs. scripts manuales de BD

---

## üíº Impacto en Diferentes √Åreas de la Instituci√≥n

### **Para la Direcci√≥n General**
- **Visibilidad**: Conocimiento exacto de la posici√≥n financiera en tiempo real
- **Control**: Supervisi√≥n efectiva de todas las operaciones
- **Estrategia**: Datos precisos para toma de decisiones estrat√©gicas

### **Para Tesorer√≠a**
- **Liquidez**: Gesti√≥n √≥ptima de flujos de efectivo
- **Inversiones**: Informaci√≥n precisa para decisiones de inversi√≥n
- **Riesgos**: Identificaci√≥n temprana de exposiciones

### **Para Operaciones**
- **Eficiencia**: Procesamiento automatizado reduce errores y tiempos
- **Capacidad**: Manejo de mayor volumen de operaciones
- **Calidad**: Consistencia en el procesamiento

### **Para Auditor√≠a y Cumplimiento**
- **Trazabilidad**: Registro completo de todas las operaciones
- **Controles**: Validaciones autom√°ticas que previenen errores
- **Reportes**: Informaci√≥n estructurada para reguladores

### **Para Servicio al Cliente**
- **Confiabilidad**: Operaciones procesadas correctamente
- **Transparencia**: Estado claro de todas las transacciones
- **Velocidad**: Procesamiento eficiente de solicitudes

---

## üö® Riesgos que Mitiga

### **Riesgo Operativo**
- **Errores humanos**: Automatizaci√≥n reduce errores manuales
- **Fraude interno**: Controles autom√°ticos detectan anomal√≠as
- **P√©rdida de datos**: Registro sistem√°tico previene p√©rdidas de informaci√≥n

### **Riesgo de Liquidez**
- **Descalces**: Previene situaciones donde no hay efectivo suficiente
- **Planificaci√≥n**: Proyecciones precisas de flujos futuros
- **Optimizaci√≥n**: Uso eficiente del capital disponible

### **Riesgo de Cumplimiento**
- **Regulatorio**: Cumple autom√°ticamente con normativas
- **Auditor√≠a**: Facilita inspecciones y auditor√≠as
- **Reportes**: Genera informaci√≥n requerida por autoridades

### **Riesgo Reputacional**
- **Confianza del cliente**: Operaciones precisas y oportunas
- **Transparencia**: Informaci√≥n clara y accesible
- **Profesionalismo**: Imagen de instituci√≥n bien gestionada

---

## üìà Beneficios Medibles

### **Eficiencia Operativa**
- **Reducci√≥n de tiempo**: Procesamiento autom√°tico vs. manual
- **Mayor volumen**: Capacidad de procesar m√°s operaciones
- **Menos errores**: Validaciones autom√°ticas reducen errores humanos

### **Ahorro de Costos**
- **Personal**: Menos necesidad de procesamiento manual
- **Errores**: Reducci√≥n de costos por correcci√≥n de errores
- **Multas**: Evita sanciones por incumplimiento normativo

### **Mejora en Ingresos**
- **Optimizaci√≥n**: Mejor uso del capital disponible
- **Velocidad**: Procesamiento m√°s r√°pido permite m√°s operaciones
- **Confianza**: Clientes satisfechos generan m√°s negocio

---

## üîÆ Valor a Futuro

### **Escalabilidad**
- Preparado para crecimiento del negocio
- Capacidad de integrar nuevos productos financieros
- Adaptable a cambios regulatorios

### **Innovaci√≥n**
- Base s√≥lida para nuevas funcionalidades
- Integraci√≥n con tecnolog√≠as emergentes (APIs, blockchain, IA)
- Facilitador de transformaci√≥n digital

### **Competitividad**
- Operaciones m√°s eficientes que la competencia
- Mejor servicio al cliente
- Capacidad de respuesta m√°s r√°pida al mercado

---

## üéØ Conclusi√≥n

Core Financiero no es simplemente un sistema de software; es la **columna vertebral digital modernizada** que permite a una instituci√≥n financiera operar de manera segura, eficiente y competitiva en el mercado actual.

### **Logros de la Modernizaci√≥n**

La exitosa migraci√≥n de PL/SQL a Java Spring Boot ha resultado en:

1. **Protege** el dinero con arquitectura moderna y 75% de cobertura de pruebas
2. **Asegura** el cumplimiento con APIs trazables y validaciones autom√°ticas
3. **Optimiza** recursos con procesamiento eficiente y consultas inteligentes
4. **Facilita** integraci√≥n con APIs REST autodocumentadas
5. **Genera** confianza con arquitectura empresarial probada

### **Ventajas Competitivas Actuales**

**Vs. Sistemas Legacy:**
- ‚úÖ **APIs REST** vs. procedimientos de base de datos
- ‚úÖ **75% de cobertura** vs. pruebas manuales
- ‚úÖ **Documentaci√≥n autom√°tica** vs. documentaci√≥n desactualizada
- ‚úÖ **Arquitectura en capas** vs. l√≥gica monol√≠tica en BD
- ‚úÖ **DevOps ready** vs. despliegues manuales

**Vs. Competencia:**
- üöÄ **Procesamiento transaccional** en tiempo real
- üîí **M√∫ltiples validaciones** antes de afectar saldos
- üìä **APIs completas** para integraci√≥n con cualquier frontend
- üß™ **Calidad garantizada** por pruebas automatizadas
- üìà **Escalabilidad** probada en arquitectura moderna

Sin un sistema como Core Financiero modernizado, una instituci√≥n financiera no solo no puede competir, sino que enfrenta riesgos operativos, regulatorios y tecnol√≥gicos que pueden comprometer su viabilidad en el mercado digital actual.

### **El Futuro es Ahora**

Este sistema representa la **transformaci√≥n digital exitosa** de procesos financieros cr√≠ticos, estableciendo las bases para:
- Integraci√≥n con sistemas de √∫ltima generaci√≥n
- Adopci√≥n de nuevas tecnolog√≠as (APIs, microservicios, cloud)
- Cumplimiento proactivo de regulaciones cambiantes
- Operaci√≥n eficiente en mercados digitales competitivos

---

*"En el mundo financiero, la precisi√≥n no es una opci√≥n, es una obligaci√≥n. Core Financiero modernizado convierte esa obligaci√≥n en una fortaleza competitiva del siglo XXI."*